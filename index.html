<!doctype html>
<!-- The Time Machine GitHub pages theme was designed and developed by Jon Rohan, on Feb 7, 2012. -->
<!-- Follow him for fun. http://twitter.com/jonrohan. Tail his code on http://github.com/jonrohan -->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <link rel="stylesheet" href="stylesheets/stylesheet.css" media="screen"/>
  <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/script.js"></script>

  <title>Redwood</title>
  <meta name="description" content="A project that implements statistical methods for identifying anomalous files">

  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body>

  <div class="wrapper">
    <header>
      <h1 class="title">Redwood</h1>
    </header>
    <div id="container">
      <p class="tagline">A project that implements statistical methods for identifying anomalous files</p>
      <div id="main" role="main">
        <div class="download-bar">
        <div class="inner">
          <a href="https://github.com/Lab41/Redwood/tarball/master" class="download-button tar"><span>Download</span></a>
          <a href="https://github.com/Lab41/Redwood/zipball/master" class="download-button zip"><span>Download</span></a>
          <a href="https://github.com/Lab41/Redwood" class="code">View Redwood on GitHub</a>
        </div>
        <span class="blc"></span><span class="trc"></span>
        </div>
        <article class="markdown-body">
          <h1>
<a name="association-based-data-reduction-redwood" class="anchor" href="#association-based-data-reduction-redwood"><span class="octicon octicon-link"></span></a>Association-Based Data Reduction (REDWOOD)</h1>

<p><i>Finding the Tree in the Forest</i></p>

<p><img src="https://raw.github.com/Lab41/Redwood/master/images/logo/redwood_logo.png" alt="Redwood" title="Redwood"></p>

<p><b>Redwood is a Python framework intended to identify anomalous files through analyzing the file metadata of a collection of media</b>. Each file analyzed is assigned a score that signals its reputation relative to other files in the system --the lower a reputation score, the more likely that a file is anomalous.  The final reputation score of a given file is based on an aggegation of scores assigned to it by modules that we call "Filters".</p>

<p>A Filter is a plugin whose functionality is only limited by the creativity of the developer.  Redwood can support any number of Filters, so long as a Filter extends the RedwoodFilter class and produces a table assigning a reputation score to each unique file in the system.  Much of the Redwood framework is aimed at making the process of adding new Filters to the system as frictionless as possible (see the Filter section below for more information).</p>   

<p>In addition to the Filters, Redwood also provides an effective data model for analyzing and storing file metadata, an API for interacting with that data, a simple shell for executing Redwood commands, and two example Filters (a "prevalence" Filter and a "locality uniqueness" Filter.  Though sample Filters are included in the project, ultimately the effectiveness of Redwood will be based on the Filters that you write for the particular anomaly that you are looking for. To that end, Redwood is nothing more than a simple framework for connecting Filters to a well-formed data model.</p> 

<h2>
<a name="quick-setup" class="anchor" href="#quick-setup"><span class="octicon octicon-link"></span></a>Quick Setup</h2>

<p>The instructions that follow should get you up and running quickly.  Redwood has been tested on  OS X and Linux. Windows will likely work with a few changes.</p>

<h4>
<a name="stuff-to-download" class="anchor" href="#stuff-to-download"><span class="octicon octicon-link"></span></a>Stuff to Download</h4>

<ol>
<li>Python 2.7</li>
<li>Python packages

<ul>
<li>SciPy (Matplotlib, MqSQLdb)</li>
</ul>
</li>
<li>MySQL Client for your client OS</li>
<li>MySQL Server for the server hosting the DB</li>
</ol><h4>
<a name="prep-the-database" class="anchor" href="#prep-the-database"><span class="octicon octicon-link"></span></a>Prep the Database</h4>

<p>Redwood uses a MySQL database to store metadata. In order to use Redwood, you will need to first set up your own MySQL DB, then run the following two SQL scripts to create the required tables and subroutines.</p>

<div class="highlight highlight-bash"><pre>mysql -uyour_db_user -pyour_password -hyour_host -Dyour_database &lt; sql/create_redwood_db.sql
mysql -uyour_db_user -pyour_password -hyour_host -Dyour_database &lt; sql/create_redwood_sp.sql
</pre></div>

<h4>
<a name="create-a-config" class="anchor" href="#create-a-config"><span class="octicon octicon-link"></span></a>Create a config</h4>

<p>Create a file containing the following configuration information specific to your database</p>

<pre><code>[mysqld]
database:your_db_name
host:your_host
username:your_username
password:your_password
</code></pre>

<h2>
<a name="run-redwood" class="anchor" href="#run-redwood"><span class="octicon octicon-link"></span></a>Run Redwood</h2>

<p>There are two ways that you can run Redwood.  If you just want to play with the tool, and maybe create a couple of filters, the "Redwood Shell" method is probably the best choice.  If you want to make modifications to the core package and or create your own UI, then you probably want to use the API.  Examples of how to do both are below:</p>

<h4>
<a name="using-the-redwood-shell" class="anchor" href="#using-the-redwood-shell"><span class="octicon octicon-link"></span></a>Using the Redwood Shell</h4>

<div class="highlight highlight-bash"><pre><span class="c">#append to the python path the Redwood directory</span>
<span class="nb">export </span><span class="nv">PYTHONPATH</span><span class="o">=</span>/path/to/Redwood
<span class="c">#from the Redwood directory run</span>
python bin/redwood /path/to/config
</pre></div>

<h4>
<a name="using-the-api-to-create-your-application" class="anchor" href="#using-the-api-to-create-your-application"><span class="octicon octicon-link"></span></a>Using the API to create your Application</h4>

<p><i>This is a brief example of how to use the API to load a media source into the database and then run specific filter functions on that source</i></p>

<div class="highlight highlight-python"><pre><span class="kn">import</span> <span class="nn">redwood.connection.connect</span> <span class="kn">as</span> <span class="nn">connect</span>
<span class="kn">import</span> <span class="nn">redwood.io.csv_importer</span> <span class="kn">as</span> <span class="nn">loader</span>
<span class="kn">import</span> <span class="nn">redwood.helpers.core</span> <span class="kn">as</span> <span class="nn">core</span>

<span class="c">#connect to the database</span>
<span class="n">cnx</span> <span class="o">=</span> <span class="n">connect</span><span class="o">.</span><span class="n">connect_with_config</span><span class="p">(</span><span class="s">"my_db.cfg"</span><span class="p">)</span>

<span class="c">#load a csv to the database</span>
<span class="n">loader</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cnx</span><span class="p">,</span><span class="s">"directory_containing_csv_data_pulls"</span><span class="p">,</span> <span class="n">false</span><span class="p">)</span>

<span class="n">core</span><span class="o">.</span><span class="n">import_filters</span><span class="p">(</span><span class="s">"./Filters"</span><span class="p">,</span> <span class="n">cnx</span><span class="p">)</span>

<span class="c">#grab instances of two specific filters</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">get_filter_by_name</span><span class="p">(</span><span class="s">"prevalence"</span><span class="p">)</span>
<span class="n">lu</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">get_filter_by_name</span><span class="p">(</span><span class="s">"locality_uniqueness"</span><span class="p">)</span>

<span class="c">#generate a histogram to see distribution of files for that source</span>
<span class="n">fp</span><span class="o">.</span><span class="n">discover_histogram_by_source</span><span class="p">(</span><span class="s">"some_source"</span><span class="p">)</span>

<span class="c">#run a survey for a particular source</span>
<span class="n">fp</span><span class="o">.</span><span class="n">run_survey</span><span class="p">(</span><span class="s">"some_source"</span><span class="p">)</span>
</pre></div>

<h2>
<a name="documentation" class="anchor" href="#documentation"><span class="octicon octicon-link"></span></a>Documentation</h2>

<p>from the root project directory, run the following</p>

<div class="highlight highlight-bash"><pre>sphinx-apidoc -o docs redwood -F<span class="p">;</span> <span class="nb">pushd </span>docs<span class="p">;</span> make html<span class="p">;</span> make man<span class="p">;</span> <span class="nb">popd</span>
</pre></div>

<h3>
<a name="data" class="anchor" href="#data"><span class="octicon octicon-link"></span></a>Data</h3>

<p>Redwood currently only loads data from a CSV file with the fields below. Information about these fields can typically be found in a stat</p>

<table>
<thead><tr>
<th>Field Name</th>
<th>Field Description</th>
</tr></thead>
<tbody>
<tr>
<td>file_id</td>
<td>Unique id of the file</td>
</tr>
<tr>
<td>parent_id</td>
<td>file_id of the parent</td>
</tr>
<tr>
<td>dirname</td>
<td>path excluding filename</td>
</tr>
<tr>
<td>basename</td>
<td>filename</td>
</tr>
<tr>
<td>hash</td>
<td>Sha1 of file contents</td>
</tr>
<tr>
<td>fs_id</td>
<td>Inode of linux or non-linux equivalent</td>
</tr>
<tr>
<td>device</td>
<td>Device Node identifier</td>
</tr>
<tr>
<td>permissions</td>
<td>Permission of the file</td>
</tr>
<tr>
<td>uid</td>
<td>User owner of the file</td>
</tr>
<tr>
<td>gid</td>
<td>Group owner of the file</td>
</tr>
<tr>
<td>size</td>
<td>Size in bytes</td>
</tr>
<tr>
<td>create_time</td>
<td>file create in  seconds from epoch</td>
</tr>
<tr>
<td>access_time</td>
<td>file last accessed in seconds from epoch</td>
</tr>
<tr>
<td>mod_time</td>
<td>file modification in seconds from epoch</td>
</tr>
<tr>
<td>metadata_change_time</td>
<td>file change in seconds from epoch</td>
</tr>
<tr>
<td>user_flags</td>
<td>user flags</td>
</tr>
<tr>
<td>links</td>
<td>links to the file</td>
</tr>
<tr>
<td>disk_offset</td>
<td>disk offset</td>
</tr>
<tr>
<td>entropy</td>
<td>entropy of the file</td>
</tr>
<tr>
<td>file_content_status</td>
<td>file content status</td>
</tr>
<tr>
<td>extensions</td>
<td>file extension if available</td>
</tr>
<tr>
<td>file_type</td>
<td>file type if auto discovered</td>
</tr>
</tbody>
</table><p>The <strong>sql/filewalk.py</strong> script will walk a hfs+ file system and (perhaps) other Unix/Linux file systems, collecting the relevant metadata using the stat command.  The output will be in the appropriate format for the load_csv command. Note, this script has been optimized for Linux/OS X.  It will not work on a Windows system... updates welcome)</p>

<h2>
<a name="redwood-architecture" class="anchor" href="#redwood-architecture"><span class="octicon octicon-link"></span></a>Redwood Architecture</h2>

<p>Redwood is composed of 5 core engines, all backed by a MySQL DB </p>

<ol>
<li>Ingestion Engine

<ul>
<li>The ingestion engine is responsible for importing data into the datastore from a metadata source file (currently only supporting csv). </li>
</ul>
</li>
<li>Global Analytics Engine

<ul>
<li>The Global Analytics Engine is responsible for performing analytics on a global scale against all metadata and then providing those results to all filters for subsequent computation in the form of queriable tables.  This engine typically conducts time intensive queries that you only want to perform once per new source.  Currently, the only Global Analytics Engine is the "Prevalence" analyzer.  This is not to be confused with the prevalence filter which leverages the tables produced by the the Prevalence analyzer. </li>
</ul>
</li>
<li>Filter Engine

<ul>
<li>The Filter Engine has two main responsiblities. The first is to create a table for the reputation scores that it has calculated for each unique file in the the database.  The second is to optionally provide a series of "Discovery" functions that are associated with the filter scoring yet can be used independently by the end user or developer to discover in more detail why a file has a paticular score. For more information, please refer to the "All About Filters" section.</li>
</ul>
</li>
<li>Aggregation Engine

<ul>
<li>The Aggregation Engine is responsible for two main duties (1)  aggregating the scores of each filter into a single reputation score based on some aggregation algorithm (2) freezing global reputation scores if the engine deems them as either definitely high or low reputations</li>
</ul>
</li>
<li>Reporting Engine

<ul>
<li>The Reporting Engine is responsible for generating a comprehensive report highlighting user specified information about the data. </li>
</ul>
</li>
</ol><h2>
<a name="all-about-filters" class="anchor" href="#all-about-filters"><span class="octicon octicon-link"></span></a>All About Filters</h2>

<h4>
<a name="summary" class="anchor" href="#summary"><span class="octicon octicon-link"></span></a>Summary</h4>

<p>Filters are the foundation of file scoring in Redwood. A Filter's central purpose is to create a score for each unique file in the system.  After Redwood runs all the filters, each unique file should have a score from each filter.  It is then that Redwood is responsible for combining these scores using an aggregation function such that each unique file has only a single score in the unique file table.  Keep in mind that numerous filters can exist in a Redwood project.<br>
In addition to generating a score for each file, a Filter can optionally create one or more "Discovery" functions.  A Discovery function is a function that allows the user of the Filter to explore the data beyond just deriving a score. It is common for a Discovery function to also be used in the calculations for file scoring -- the Redwood model just provides a structured way for the developer to make that function available to the end user. </p>

<h4>
<a name="writing-your-own-filter" class="anchor" href="#writing-your-own-filter"><span class="octicon octicon-link"></span></a>Writing your own Filter</h4>

<p>Your filter should inherit from the base class RedwoodFilter in redwood.filters.redwood_filter. You must override those functions that raise a "NotImplementedError".  To assist in writing your own filter, look at the sample filters (locality_uniqueness and file_prevalence) in the Filters directory. </p>

<ul>
<li>If you are using the Redwood Shell, any Filter placed in the Filters directory will be automatically imported into the application. </li>
<li>All discovery functions should be preceded by "discover_" in their name so that during introspection a developer knows which functions are intended for discovery</li>
<li>A Filter is free to create any tables in the database. This can become necessary for efficiently calculating the reputation scores</li>
<li>The update function must produce (or update if not exists) a table called self.score_table with two columns (id, score) where the id is the unique_file.id of the the given file and the score is the calculated score</li>
<li>The self.cnx instance variable must be set prior to running any of the functions of the filter. The self.cnx is a mysql connection object. Redwood will set the cnx instance if you use its import functions.</li>
</ul><div class="highlight highlight-python"><pre><span class="k">class</span> <span class="nc">YourFilterName</span><span class="p">(</span><span class="n">RedwoodFilter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"YourFilterName"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_table</span> <span class="o">=</span> <span class="s">"YourScoreTableName"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnx</span>
    <span class="k">def</span> <span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">"Your usage statement"</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_name</span><span class="p">):</span>
        <span class="c">#code to update all filter tables with source_name data</span>

    <span class="c">#survey function</span>
    <span class="k">def</span> <span class="nf">run_survey</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
        <span class="n">your</span> <span class="n">code</span>

    <span class="c">#build</span>
    <span class="k">def</span> <span class="nf">build</span><span class="p">():</span>
        <span class="n">your</span> <span class="n">code</span>

    <span class="c">#clean</span>
    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">your</span> <span class="n">code</span>

    <span class="c">#discovery functions</span>
    <span class="k">def</span> <span class="nf">discover_your_discover_func0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg0</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">argN</span><span class="p">):</span>
        <span class="n">your</span> <span class="n">code</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">discover_your</span> <span class="n">discover_funcM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg0</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">argN</span><span class="p">):</span>
        <span class="n">your</span> <span class="n">code</span>

</pre></div>

<h2>
<a name="screen-shots" class="anchor" href="#screen-shots"><span class="octicon octicon-link"></span></a>Screen Shots</h2>

<p><i>Sceenshot of the Sample Shell</i><br><img src="https://raw.github.com/Lab41/Redwood/master/images/redwood_0.png" alt="Shell" title="Redwood Shell"><br><i>Sceenshot of the Filter Options</i><br><img src="https://raw.github.com/Lab41/Redwood/master/images/discovery.png" alt="Shell" title="Filter Options"><br><i>Sceenshot of the File Distribution discovery function for Filter Prevalence</i><br><img src="https://raw.github.com/Lab41/Redwood/master/images/histogram0.png" alt="Shell" title="Prevalence Filter file distribution"><br><i>Sceenshot of the discovery function for Locality Uniqueness</i><br><img src="https://raw.github.com/Lab41/Redwood/master/images/clustering.png" alt="Clustering" title="Locality Uniquenss Clustering"></p>

<h2>
<a name="optimizing-mysql-notes" class="anchor" href="#optimizing-mysql-notes"><span class="octicon octicon-link"></span></a>Optimizing MySQL Notes</h2>

<p>bulk_insert_buffer_size: 8G</p>

<p><a href="https://bitdeli.com/free" title="Bitdeli Badge"><img src="https://d2weczhvl823v0.cloudfront.net/Lab41/redwood/trend.png" alt="Bitdeli Badge"></a></p>
        </article>
      </div>
    </div>
    <footer>
      <div class="owner">
      <p><a href="https://github.com/Lab41" class="avatar"><img src="https://0.gravatar.com/avatar/109973d4bd83260a40f201ae14c67544?d=https%3A%2F%2Fidenticons.github.com%2Fa0c9a403b1214cb176d1480524db8853.png&amp;r=x&amp;s=60" width="48" height="48"/></a> <a href="https://github.com/Lab41">Lab41</a> maintains <a href="https://github.com/Lab41/Redwood">Redwood</a></p>


      </div>
      <div class="creds">
        <small>This page generated using <a href="http://pages.github.com/">GitHub Pages</a><br/>theme by <a href="https://twitter.com/jonrohan/">Jon Rohan</a></small>
      </div>
    </footer>
  </div>
  <div class="current-section">
    <a href="#top">Scroll to top</a>
    <a href="https://github.com/Lab41/Redwood/tarball/master" class="tar">tar</a><a href="https://github.com/Lab41/Redwood/zipball/master" class="zip">zip</a><a href="" class="code">source code</a>
    <p class="name"></p>
  </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-40464073-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

</body>
</html>
